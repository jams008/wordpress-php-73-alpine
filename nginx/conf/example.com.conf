
server {
    listen 80;
    index index.php index.html;
    error_log  /var/log/nginx/error.log;
    access_log /var/log/nginx/access.log;
    server_tokens off;
    root /var/www;
    server_name example.com; ## change domain
    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-XSS-Protection "1; mode=block";
    # cache informations about FDs, frequently accessed files
    # can boost performance, but you need to test those values
    open_file_cache max=200000 inactive=20s;
    open_file_cache_valid 30s;
    open_file_cache_min_uses 2;
    open_file_cache_errors on;
    reset_timedout_connection on;

    # request timed out -- default 60
    # Jangan terlalu kecil, koneksi indonesia jelek
    client_body_timeout 30;
    client_header_timeout 30;

    # if client stop responding, free up memory -- default 60
    # Jangan terlalu kecil, koneksi indonesia jelek
    send_timeout 30;

    # server will close connection after this time -- default 75
    keepalive_timeout 30;

   ##
   # `gzip` Settings
   #
   #
   gzip on;
   gzip_disable "msie6";
   
   gzip_vary on;
   gzip_proxied any;
   gzip_comp_level 6;
   gzip_buffers 16 8k;
   gzip_http_version 1.1;
   gzip_min_length 256;
   gzip_types
     application/atom+xml
     application/geo+json
     application/javascript
     application/x-javascript
     application/json
     application/ld+json
     application/manifest+json
     application/rdf+xml
     application/rss+xml
     application/xhtml+xml
     application/xml
     font/eot
     font/otf
     font/ttf
     image/svg+xml
     text/css
     text/javascript
     text/plain
     text/xml;
    
    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass app:9000;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~* \.(?:css|js)$ {
     access_log        off;
     log_not_found     off;
     add_header        Cache-Control "no-cache, public, must-revalidate, proxy-revalidate";
   }
   
   location ~* \.(?:jpg|jpeg|gif|png|ico|xml|mp4|ogg|webm|m4v|3gp|mov|avi|flv)$ {
     access_log        off;
     log_not_found     off;
     expires           max;
     add_header        Cache-Control "public";
   }
   
   location ~* \.(?:eot|woff|woff2|ttf|svg|otf) {
     access_log        off;
     log_not_found     off;
     expires           max;
     add_header        Cache-Control "public";
     add_header        Access-Control-Allow-Origin *;
   
     types     {font/opentype otf;}
     types     {application/vnd.ms-fontobject eot;}
     types     {font/truetype ttf;}
     types     {application/font-woff woff;}
     types     {font/x-woff woff2;}
   }

    location ~ /\. {
      access_log        off;
      log_not_found     off;
      deny              all;
    }
}
